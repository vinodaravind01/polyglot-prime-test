## SHIN-NY FHIR IG test fixtures

- `happy-path` directory contains FHIR JSON Bundles that should "run clean" and generate no validation warnings or errors from the FHIR validation engines
- `unhappy-path` directory contains FHIR JSON Bundles that should deterministically generate validation errors based on "broken" content 

### "Happy Path" fixtures

Contains FHIR JSON Bundles that should "run clean" and generate no validation warnings or errors from the FHIR validation engines.

#### _Happy Path_ fixture naming conventions

The fixture file naming is as follows:

```<first-name>_<lstn-ame>_<family-name>_<bundle-id>.json```

For example:

For a fixture with the following data:

```json
{
  "id": "4d678b50-d57b-97cd-d8f5-97209d6b2e6d",
  .....
        "name": [{
                "use": "official",
                "family": "Kihn564",
                "given": ["Angele108", "Keitha498"],
                "prefix": ["Mrs."]
            }
        ]
  ..... 
}
```
The fixture file name will be: *Angele108_Keitha498_Kihn564_4d678b50-d57b-97cd-d8f5-97209d6b2e6d.json*

#### How to generate _Happy Path_ fixtures...
```
git clone https://github.com/synthetichealth/synthea.git
cd synthea
./gradlew build check test
```

Create a folder named `ig` in the synthea root folder and copy the implementatation guide json file to `ig` folder

```
mkdir ig
cd ig
wget -O StructureDefinition-SHINNYBundleProfile.json http://localhost:8000/ImplementationGuide/HRSN/StructureDefinition-SHINNYBundleProfile.json
cd ..
./run_synthea -ig ig/
```

The generated files will be in the `output/fhir` folder and copy the json with  file name format ```<first-name>_<lstn-ame>_<family-name>_<bundle-id>.json``` into  `happy-path` folder.

```
cp output/fhir/<first-name>_<lstn-ame>_<family-name>_<bundle-id>.json [path-to-polyglot-prime]/hub-prime/src/test/resources/org/techbd/fixtures/happy-path
```

```
polyglot-prime
└── hub-prime
    └── src
        └── test
            └── resources
                └── org
                    └── techbd
                        └── fixtures
                            └── happy-path

```
### "Unhappy Path" fixtures

Contains FHIR JSON Bundles that should deterministically generate validation errors based on "broken" content.

#### _Unhappy Path_ fixture naming conventions

```<first-name>_<lstn-ame>_<family-name>_<bundle-id>.json```

For example:

For a fixture with the following data:

```json
{
  "id": "4d678b50-d57b-97cd-d8f5-97209d6b2e6d",
  .....
        "name": [{
                "use": "official",
                "family": "Kihn564",
                "given": ["Angele108", "Keitha498"],
                "prefix": ["Mrs."]
            }
        ]
  ..... 
}
```
The fixture file name will be: *Angele108_Keitha498_Kihn564_4d678b50-d57b-97cd-d8f5-97209d6b2e6d.json*

#### How to generate _Unhappy Path_ fixtures...

To generate unhappy path fixtures, start by creating a happy path fixture as described above. Then, use this file to create the unhappy path fixtures. Follow the steps to intentionally invalidate the Synthea-generated output file.

1. Open ChatGpt 4
2. Upload the IG file, prompting - *Read this FHIR v4 Implementation Guide, to make the system learn the IG content.*
3. Go to the `output/fhir` folder and locate the file with the naming format - `<first-name>_<lstn-ame>_<family-name>_<bundle-id>.json`
4. Upload this file also to the Chat GPT, prompting - *Use this attachment as valid Synthea generated FHIR JSON which should pass the IG validation. Generate for me another JSON file based on this attachment with 10 errors of severity ResultSeverityEnum.ERROR introduced that would allow me to do a deterministic test of the IG validation using HAPI validation engine. Make sure you do not add errors like  'Incorrect Resource Type'  as this is FATAL error and the remaining errors wont be validated.The current file name is in the format <first-name>_<lstn-ame>_<family-name>_<bundle-id> .The newly generated file should have a description of error generated instead of <bundle-id>.*

Download the file generated by Chat GPT and copy the same into `unhappy-path` folder.
For this, go to Download folder and run the command.
```
cp <first-name>_<lstn-ame>_<family-name>*.json [path-to-polyglot-prime]/hub-prime/src/test/resources/org/techbd/fixtures/uphappy-path
```

```
polyglot-prime
└── hub-prime
    └── src
        └── test
            └── resources
                └── org
                    └── techbd
                        └── fixtures
                            └── unhappy-path

```

### Unhappy path test fixtures:
Here, the unhappy path fixtures are created from the happy path file - *Angele108_Keitha498_Kihn564_4d678b50-d57b-97cd-d8f5-97209d6b2e6d.json*
Details of the generated unhappy path fixture files and a summary of the new errors introduced:
1. **Niesha86_Powlowski563_with_errors.json**
   1. **Incorrect Code in a ValueSet**: Replace a valid code in a ValueSet with an invalid one.
   2. **Missing Required Element**: Remove a required element from one of the resources.
   3. **Incorrect Data Type**: Change the data type of an element (e.g., changing a string to an integer).
   4. **Invalid URL Format**: Alter a URL to an incorrect format.
   5. **Invalid Reference**: Modify a reference to point to a non-existent resource.
   6. **Incorrect Date Format**: Change a date format to one that is not compliant with FHIR standards.
   7. **Duplicate Identifier**: Introduce a duplicate identifier within the same resource.
   8. **Invalid Value for a CodeableConcept**: Change the value in a CodeableConcept to an invalid one.
   9. **Invalid Identifier System**: Modify the system URL in an Identifier to an invalid URL.
   10. **Incorrect Binding**: Change a bound value set to a code that is not part of the value set.'''
